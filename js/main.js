define("audio",[],function(){return function(e){document.getElementById("audio-"+e).play()}}),define("gift",["audio"],function(e){function t(e){this.body=$(document.body),this.box=$(".game"),this.santa=$(".gm-santa"),this.elf=$(".gm-elf"),this.dropTime=3e3,this.bar=e,this.body.hasClass("red")&&(this.mainColor="red"),this.body.hasClass("blue")&&(this.mainColor="blue"),this.body.hasClass("green")&&(this.mainColor="green"),this._init()}return t.prototype={_init:function(){var e=this;e.color=e._getColor(),e.id="gift-"+parseInt((new Date).getTime()/1e3);var t='<div class="gm-gift '+e.color+'" id="'+e.id+'"></div>';e.box.append(t),e.gift=$("#"+e.id);var n=e.elf[0].offsetLeft;e.gift.css({left:n}).addClass("gm-anim");var r=e.box.height();setTimeout(function(){e.gift.css({top:r})},10),setTimeout(function(){e.gift.remove()},e.dropTime),e._setTimers()},_getColor:function(){var e=this,t=["red","green","blue"],n=parseInt(Math.random()*3);return t[n]},_setTimers:function(){var e=this,t=e._calcSpeed(),n=e._calTimeout(t)-100;setTimeout(function(){e._setCheck(n)},n)},_calcSpeed:function(){var e=this,t=e.box.height()-e.gift[0].offsetTop,n=t/e.dropTime;return n},_calTimeout:function(e){var t=this,n=t.santa[0].offsetTop-t.gift[0].offsetTop,r=n/e;return r},_setCheck:function(e){var t=this;t.checkTimer=setInterval(function(){t._checkPos()},200),setTimeout(function(){t.checkTimer&&clearTimeout(t.checkTimer)},t.dropTime-e)},_checkPos:function(){var e=this,t=e.santa.width(),n=e.gift.width(),r=e.santa[0].offsetLeft+t/2,i=e.gift[0].offsetLeft+n/2,s=Math.abs(r-i),o=(t+n)/2,u=s<o;u&&e._score()},_score:function(){var t=this;t.color==t.mainColor?(t._mark(1),t._display(1),e("plus")):(t._mark(-1),t._display(-1),e("minus")),clearTimeout(t.checkTimer),t.gift.addClass("hide")},_display:function(e){var t=this,n=e>0?"gm-plus":"gm-minus",r="gm-score"+(new Date).getTime(),i='<div class="hide gm-score '+n+'" id="'+r+'"></div>';t.box.prepend(i);var s=parseInt((t.box.width()-50)*Math.random()),o=$("#"+r);o.css({left:s}).removeClass("hide"),setTimeout(function(){o.addClass("gm-gone")},500),setTimeout(function(){o.remove()},1500)},_mark:function(e){var t=this,n=$("#mark-num"),r=parseInt(n.text())+e;r=r<0?0:r,n.text(r),r=r>t.bar?t.bar:r;var i=parseInt(r/t.bar*100);$("#mark-inner").css({width:i+"%"})}},t}),define("config",{log:"/chris/log",man:"/chris/man",woman:"/chris/woman",sdyk:"/chris/sdyk",gxbgf:"/chris/gxbgf",zsjsd:"/chris/zsjsd",success:"/chris/success",fail:"/chris/fail",share:"/chris/share",area:"/chris/area",shops:"../data/shops.json",cities:"../data/cities.json",imgPath:"../img/",imgs:["bg-1.jpg","bg-2.jpg","boy.png","boy-gray.png","btn.png","btn-gray.png","cv-sled.png","cv-start.png","cv-t.png","elf.png","fl-again.png","fl-main.png","fl-santa.png","fl-share.png","fl-t.png","fq-next.png","fq-t.png","girl.png","girl-gray.png","gm-1.png","gm-2.png","gm-3.png","gm-demo-hand.png","gm-demo-t.png","gm-go.png","gm-over.png","gm-ready.png","gm-elf.png","gm-santa.png","paper.png","ps-blue.png","ps-green.png","ps-red.png","ps-shop.png","ps-t.png","rl-start.png","rl-t.png"],shareTitle:{normal:"天上不掉馅饼，掉好礼啦！",pass:{red:"撒花！我赢得了粉色大礼包.萌萌哒～",blue:"蓝色大礼包赢到手，型格如我、不服来战！",green:"yeah～绿色大礼包到手，资深技术党的荣耀！"},fail:{red:"哭晕…没赢到大礼包！爱我就快替我抢一个回来！",blue:"大礼包与我无缘.但…主要输在气质",green:"大礼包与我无缘.但…主要输在气质"}}}),define("game",["gift","config","audio"],function(e,t,n){function o(){this.score=0,this.bar=10,this.dur=40,this.tick=this.dur,this.giftInterval=500,this.elfTimer=null,this.giftTimer=null,this.timeTimer=null,r.hasClass("red")&&(this.mainColor="red"),r.hasClass("blue")&&(this.mainColor="blue"),r.hasClass("green")&&(this.mainColor="green"),this._init()}var r=$(document.body),i=$(".game");i.on("touchstart",function(e){e.preventDefault(),e.stopPropagation()});var s='<div class="gm-tip full"></div>';return o.prototype={_init:function(){var e=this;$("#time-num").text(e.dur),$("#mark-num").text(0),$("#time-inner").css({width:"100%"}),$("#mark-inner").css({width:"0%"}),e._demo()},_demo:function(){var e=this;$(".gm-santa").addClass("hide"),$(".gm-demo").removeClass("hide"),setTimeout(function(){$(".gm-demo").addClass("hide"),e._ready(),e._bindSanta()},5e3)},_ready:function(){var e=this;i.append(s);var t=$(".gm-tip");t.addClass("gm-3"),setTimeout(function(){t.addClass("gm-2")},1e3),setTimeout(function(){t.addClass("gm-1")},2e3),setTimeout(function(){t.addClass("gm-ready")},3e3),setTimeout(function(){t.addClass("gm-go")},4e3),setTimeout(function(){t.remove(),e._start()},5e3)},_bindSanta:function(){var e=this,t=$(".gm-santa");t.removeClass("hide");var n=t.width(),i=n,s=n/2,o=r.width()-s,u=(r.width()-n)/2;t.css({left:u}).on("touchmove",function(e){i=e.touches[0].pageX,i=i<s?s:i,i=i>o?o:i,i-=n/2,t.css({left:i})})},_start:function(){var e=this;e._elfStart(),e._giftStart(),e._timeStart(),setTimeout(function(){e._end()},e.dur*1e3)},_elfStart:function(){function s(){t.toggleClass("elf-right");var e=t.hasClass("elf-right")?i:0;t.css({left:e})}var e=this,t=$(".gm-elf"),n=t.width(),i=r.width()-n;s(),e.elfTimer=setInterval(s,2e3)},_giftStart:function(){var t=this;t.giftTimer=setInterval(function(){new e(t.bar)},t.giftInterval)},_timeStart:function(){function t(){e.tick--,$("#time-num").text(e.tick);var t=parseInt(e.tick/e.dur*100),n=t+"%";$("#time-inner").css({width:n})}var e=this;e.timeTimer=setInterval(function(){t()},1e3)},_end:function(){var e=this;clearInterval(e.elfTimer),clearInterval(e.giftTimer),clearInterval(e.timeTimer),e._result()},_result:function(){var e=this;i.append(s);var r=$(".gm-tip");e.score=parseInt($("#mark-num").text());if(e.score>=e.bar){window._rs=!0,r.addClass("gm-pass"),n("pass");var o=$(".pass");document.title=t.shareTitle.pass[e.mainColor],$.get(t.success)}else{window._rs=!1,r.addClass("gm-fail"),n("fail");var o=$(".fail");document.title=t.shareTitle.fail[e.mainColor],$.get(t.fail)}setTimeout(function(){r.remove(),$(".game").addClass("hide"),o.removeClass("hide")},2e3)}},o}),define("share",["config"],function(e){var t='<div class="share-box full">	<div class="share-arrow"></div>	<div class="share-text">		<p>请点击右上角</p>		<p>将它发送给指定朋友</p>		<p>或分享到朋友圈</p>	</div></div>';return function(){$(document.body).append(t);var n=$(".share-box");n.on("click",function(e){n.remove()}),$.get(e.share)}}),define("loading",["config"],function(e){function s(){var e=Math.round(i/r*100)+"%";$(".ld-in").css({width:e})}function o(e){var t=$(e).attr("data-src");console.log("Load resource fail : "+t)}function u(){$(".loading").addClass("hide"),$(".cover").removeClass("hide")}var t="";$.each(e.imgs,function(n,r){var i=e.imgPath+r;t+='<img class="preload" src="" data-src="'+i+'">'}),$(".ld-pic").append(t);var n=$(".preload"),r=n.length,i=0;n.on("load",function(e){i++,s(),i==r&&u()}).on("error",function(e){i++,o(this),i==r&&u()}).each(function(e){$(this).attr({src:$(this).attr("data-src")})})}),define("tip",[],function(){return function(e){var t='<section class="tip-box">	<div class="center"><span>'+e+"</span></div>"+"</section>";$(document.body).append(t);var n=$(".tip-box"),r=setTimeout(function(){n.remove()},1500);n.on("click",function(){n.remove(),clearTimeout(r)})}}),define("faq",["config","tip","audio"],function(e,t,n){function r(e){e.on("click",function(e){var t=$(e.currentTarget);t.siblings(".checked").removeClass("checked"),t.addClass("checked"),n("btn")})}function s(t,n){var r=[e.woman,e.man],i=[e.sdyk,e.gxbgf,e.zsjsd];$.get(r[t.index()]),$.get(i[n.index()])}r($(".fq-gender")),r($(".fq-btns").children("li"));var i=[["red","red","green"],["blue","blue","green"]];$(".fq-next").on("click",function(e){n("btn");var r=$(".fq-gender").filter(".checked"),o=$(".fq-btns").children(".checked");if(r.length!=1){t("请选择性别");return}if(o.length!=1){t("请选择一句话描述自己");return}var u=i[r.index()][o.index()];$(document.body).removeClass("red").removeClass("blue").removeClass("green").addClass(u),$(".faq").addClass("hide"),$(".rule").removeClass("hide"),s(r,o)})}),define("geo",[],function(){return function(e,t){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=t.coords.longitude,r=t.coords.latitude;e(n,r)},function(e){t&&t(e.code)},{timeout:5e3}):t&&t(4)}}),define("shops",["geo","config","audio"],function(e,t,n){function i(){e(function(e,t){s(e,t)},function(e){u()})}function s(e,t){AMap.service("AMap.Geocoder",function(){var n=new AMap.Geocoder({radius:1e3,extensions:"all"});n.getAddress([e,t],o)})}function o(e,t){if(e!="complete"){u();return}if(t.info!="OK"){u();return}var n=t.regeocode.addressComponent.citycode;if(!n){u();return}a(n)}function u(){var e="";$.each(r,function(t,n){e+='<li class="ls-city-li" data-city-code="'+n.code+'">'+n.name+"</li>"}),$(".ls-city-ul").append(e),$(".ls-shop-ul").addClass("hide"),$(".ls-city-ul").removeClass("hide"),$(".ls-city-tip").removeClass("hide")}function a(e){var t=r.length;for(var n=0;n<t;n++){var i=r[n].code;e==i&&f(e)}}function f(e){var n=[],r=[];$.get(t.shops,function(t){n=t,$.each(n,function(t,n){e==n.cityCode&&r.push(n)}),l(r)},"json"),$(".ls-city-ul").addClass("hide"),$(".ls-city-tip").addClass("hide"),$(".ls-shop-ul").removeClass("hide")}function l(e){var t="";$.each(e,function(e,n){t+='<li class="ls-shop-li" data-loc="'+n.loc+'">'+"	<p>"+n.name+"</p>"+"	<p>"+n.addr+"</p>"+"</li>"}),$(".ls-shop-ul").append(t)}var r=[];$.get(t.cities,function(e){r=e,i()},"json"),$(document.body).delegate(".ls-city-li","click",function(e){var t=$(e.currentTarget).attr("data-city-code");f(t),n("btn")})}),define("map",["audio"],function(e){var t=new AMap.Map("mp-main",{level:17}),n=null;$(document.body).delegate(".ls-shop-li","click",function(r){e("btn");var i=$(r.currentTarget),s=i.children("p").eq(0).text(),o=i.attr("data-loc"),u=o.split(",")[0],f=o.split(",")[1],l=new AMap.LngLat(u,f);n&&n.hide(),n=new AMap.Marker({position:l}),n.setMap(t),t.setZoomAndCenter(17,l),$(".mp-name").text(s),$(".list").addClass("hide"),$(".map").removeClass("hide")})}),require(["game","share","config","audio","loading","faq","shops","map"],function(e,t,n,r){window._rs=null,$.get(n.log),document.getElementById("audio-load").play(),$(".cv-start").on("click",function(){$(".cover").addClass("hide"),$(".faq").removeClass("hide"),r("btn")}),$(".rl-start").on("click",function(){$(".rule").addClass("hide"),$(".game").removeClass("hide"),document.getElementById("audio-load").pause(),new e,r("btn")}),$(".fl-again").on("click",function(){$(".fail").addClass("hide"),$(".rule").removeClass("hide"),document.title=n.shareTitle.normal,r("btn")}),$(".fl-share").add(".ps-share").on("click",function(){t(),r("btn")}),$(".ps-shop").add(".fl-shop").on("click",function(e){$(".pass").addClass("hide"),$(".fail").addClass("hide"),$(".list").removeClass("hide"),$.get(n.area),r("btn")}),$(".ls-back").on("click",function(){$(".list").addClass("hide"),window._rs?$(".pass").removeClass("hide"):$(".fail").removeClass("hide"),r("btn")}),$(".mp-back").on("click",function(){$(".map").addClass("hide"),$(".list").removeClass("hide"),r("btn")})}),define("main",function(){});